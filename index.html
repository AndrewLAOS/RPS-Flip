<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Whimsical RPS Shop Game</title>

  <link href="https://fonts.googleapis.com/css2?family=Comfortaa&display=swap" rel="stylesheet" />

  <style>
    /* Reset + base */
    body {
      font-family: 'Comfortaa', cursive, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at top left, #89f7fe, #66a6ff);
      color: #222;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 2em 0;
      user-select:none;
    }
    h1 {
      margin-bottom: 0.5em;
      color: #2c3e50;
      text-shadow: 1px 1px 4px #a0c8ff;
      font-weight: 700;
      font-size: 2.4rem;
    }
    #container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.25);
      padding: 2em 2.5em;
      max-width: 480px;
      width: 95vw;
      text-align: center;
      min-height: 540px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    .nav-buttons {
      margin-bottom: 1.2em;
      display: flex;
      justify-content: center;
      gap: 22px;
    }
    .nav-buttons button {
      padding: 12px 28px;
      font-size: 18px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      background: linear-gradient(145deg, #66a6ff, #357ae8);
      color: white;
      font-weight: 700;
      box-shadow: 0 6px 14px #357ae8aa;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      letter-spacing: 0.04em;
      user-select:none;
      outline-offset: 3px;
      outline-color: transparent;
    }
    .nav-buttons button:focus {
      outline-color: #1a73e8;
    }
    .nav-buttons button.active {
      background: linear-gradient(145deg, #357ae8, #194a9f);
      box-shadow: 0 8px 24px #194a9fcc;
      font-weight: 800;
    }
    .nav-buttons button:hover:not(.active) {
      background: linear-gradient(145deg, #7ab8ff, #4a8ff7);
      box-shadow: 0 6px 16px #4a8ff7aa;
    }

    #coin-display {
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 1em;
      color: #34495e;
      user-select:none;
      letter-spacing: 0.04em;
    }

    /* Choices */
    .choices {
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 1.2em;
      min-height: 110px;
    }
    button.choice {
      background: linear-gradient(145deg, #e0e8ff, #c4d7ff);
      border: 2px solid #366ed8;
      border-radius: 18px;
      padding: 18px 20px;
      cursor: pointer;
      font-size: 20px;
      width: 90px;
      height: 90px;
      user-select: none;
      transition:
        transform 0.25s cubic-bezier(0.4,0,0.2,1),
        box-shadow 0.3s ease,
        background 0.3s ease,
        border-color 0.3s ease,
        color 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      font-weight: 600;
      color: #1e2a78;
      text-shadow: 0 0 3px #a0bfffaa;
      box-shadow: 0 2px 6px #9bb3ff88;
      user-select:none;
    }
    button.choice:disabled {
      cursor: not-allowed;
      opacity: 0.45;
      box-shadow: none;
      border-color: #aaa;
      color: #777;
      background: #dde6f7;
    }
    button.choice:hover:not(:disabled) {
      background: linear-gradient(145deg, #d1defe, #aec3ff);
      border-color: #1e2a78;
      color: #0f1d50;
      transform: scale(1.2) translateY(-5px);
      box-shadow:
        0 6px 20px #5179ffcc,
        inset 0 0 14px #5179ffcc;
      text-shadow: 0 0 6px #5f7bffcc;
    }
    .choice-icon {
      font-size: 44px;
      line-height: 1;
      user-select:none;
      text-shadow: 0 0 10px #5179ffbb;
    }

    /* Results message */
    .results {
      font-weight: 700;
      min-height: 3em;
      margin-bottom: 1.4em;
      font-size: 20px;
      color: #2c3e50;
      text-shadow: 0 0 2px #a0c8ff;
      user-select:none;
    }

    /* Scoreboard */
    .scoreboard {
      display: flex;
      justify-content: space-around;
      font-size: 20px;
      margin-bottom: 1.5em;
      color: #2c3e50;
      user-select:none;
    }
    .scoreboard div {
      background: #607d8b;
      color: white;
      border-radius: 12px;
      padding: 0.7em 1.6em;
      min-width: 120px;
      font-weight: 700;
      text-shadow: 0 0 4px #455a64;
      user-select:none;
    }

    /* Shop styles */
    #shop {
      display: none;
      flex-direction: column;
      gap: 1.4em;
      max-height: 300px;
      overflow-y: auto;
      padding: 0 6px;
      scroll-behavior: smooth;
    }
    #shop .rarity-section {
      text-align: left;
      font-weight: 700;
      font-size: 18px;
      margin-top: 12px;
      margin-bottom: 6px;
      color: #34495e;
      user-select:none;
      text-shadow: 0 0 3px #a0c8ff;
    }
    #shop .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ecf0f1;
      border-radius: 18px;
      padding: 14px 20px;
      font-size: 20px;
      cursor: pointer;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      user-select:none;
      font-weight: 600;
      color: #34495e;
      box-shadow: inset 0 0 5px #dfe6f7;
      border: 2px solid transparent;
    }
    #shop .item.disabled {
      cursor: not-allowed;
      opacity: 0.45;
      box-shadow: none;
      color: #7f8c8d;
      background: #d1d9e6;
      border-color: transparent;
    }
    #shop .item:hover:not(.disabled) {
      background: #66a6ff;
      color: white;
      box-shadow: 0 6px 20px #357ae8cc;
      border-color: #194a9f;
    }
    #shop .item.owned {
      background: #a4d4ff;
      cursor: default;
      color: #0a3d8f;
      font-weight: 700;
      box-shadow: inset 0 0 20px #3b6edecc;
      border-color: #1b3e8a;
    }
    #shop .item .name {
      display: flex;
      align-items: center;
      gap: 14px;
      user-select:none;
    }
    #shop .item .name .icon {
      font-size: 36px;
      text-shadow: 0 0 12px #3b6edecc;
      user-select:none;
    }
    #shop .item .price {
      font-weight: 800;
      min-width: 70px;
      user-select:none;
    }
    /* Rarity colors for border */
    .rarity-Common { border-color: #a9a9a9; }
    .rarity-Rare { border-color: #ff6347; }
    .rarity-Epic { border-color: #9b59b6; }
    .rarity-Legendary { border-color: #f1c40f; }

    /* Animations */
    @keyframes rockShake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(10deg); }
      50% { transform: rotate(-10deg); }
      75% { transform: rotate(8deg); }
    }

    @keyframes paperFlutter {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }

    @keyframes scissorsCut {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(20deg) translateX(5px); }
      100% { transform: rotate(0deg) translateX(0); }
    }

    @keyframes fireFlicker {
      0%, 100% { filter: drop-shadow(0 0 5px #ff6); }
      50% { filter: drop-shadow(0 0 15px #ff0); }
    }

    @keyframes waterSplash {
      0%, 100% { transform: scale(1) translateY(0); }
      50% { transform: scale(1.2) translateY(-10px); }
    }

    @keyframes robotBlink {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.6); }
    }

    @keyframes lightningStrike {
      0%, 100% { filter: drop-shadow(0 0 10px #ffd700); }
      50% { filter: drop-shadow(0 0 25px #fff200); }
    }

    @keyframes windBlow {
      0%, 100% { transform: translateX(0) translateY(0); }
      50% { transform: translateX(8px) translateY(-6px) rotate(5deg); }
    }

    @keyframes earthPulse {
      0%, 100% { box-shadow: 0 0 0 0 #8b4513aa inset; }
      50% { box-shadow: 0 0 18px 6px #8b4513cc inset; }
    }

    @keyframes wizardGlow {
      0%, 100% { filter: drop-shadow(0 0 8px #6a0dad); }
      50% { filter: drop-shadow(0 0 24px #9400d3); }
    }

    @keyframes dragonFire {
      0%, 100% { filter: drop-shadow(0 0 12px #ff4500); }
      50% { filter: drop-shadow(0 0 30px #ff6347); }
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Whimsical RPS Shop Game</h1>
    <div class="nav-buttons">
      <button id="btnGame" class="active" aria-label="Switch to Game View">Game</button>
      <button id="btnShop" aria-label="Switch to Shop View">Shop</button>
    </div>
    <div id="coin-display" aria-live="polite">Coins: <span id="coins">0</span></div>

    <!-- Game View -->
    <section id="game" aria-label="Rock Paper Scissors Game" role="region" tabindex="-1">
      <div class="choices" id="choices" aria-label="Available choices">
        <!-- Choices buttons dynamically inserted here -->
      </div>
      <div class="results" id="results" aria-live="polite">Choose your item to play!</div>
      <div class="scoreboard" aria-label="Scoreboard">
        <div>Player: <span id="playerScore">0</span></div>
        <div>Bot: <span id="botScore">0</span></div>
      </div>
    </section>

    <!-- Shop View -->
    <section id="shop" aria-label="Shop to buy new items" role="region" tabindex="-1">
      <!-- Shop items dynamically inserted here -->
    </section>
  </div>

  <footer style="margin-top: 1.5em; font-size: 14px; color: #222a; user-select:none;">
    Made by Andrew â€” Deploy on Netlify
  </footer>

  <script type="module">
    import { allItems, RARITY } from './items.js';
    import { animateChoice } from './animations.js';

    // Game state
    let coins = 0;
    let playerScore = 0;
    let botScore = 0;

    // Owned items - start with base common only (cost 0)
    let ownedItems = new Set(
      Object.entries(allItems)
        .filter(([_, item]) => item.cost === 0)
        .map(([key]) => key)
    );

    // DOM refs
    const coinsSpan = document.getElementById('coins');
    const resultsDiv = document.getElementById('results');
    const playerScoreSpan = document.getElementById('playerScore');
    const botScoreSpan = document.getElementById('botScore');
    const choicesDiv = document.getElementById('choices');
    const shopDiv = document.getElementById('shop');

    const btnGame = document.getElementById('btnGame');
    const btnShop = document.getElementById('btnShop');
    const gameView = document.getElementById('game');
    const shopView = document.getElementById('shop');

    // Helper for capitalization
    function capitalize(word) {
      return word.charAt(0).toUpperCase() + word.slice(1);
    }

    // Update UI coin display
    function updateCoins() {
      coinsSpan.textContent = coins;
    }

    // Update scores UI
    function updateScores() {
      playerScoreSpan.textContent = playerScore;
      botScoreSpan.textContent = botScore;
    }

    // Build choices UI from owned items
    function buildChoices() {
      choicesDiv.innerHTML = '';
      const sortedOwned = [...ownedItems].sort((a,b) => {
        // Sort by rarity then name
        const rarA = allItems[a].rarity;
        const rarB = allItems[b].rarity;
        if (rarA === rarB) return allItems[a].name.localeCompare(allItems[b].name);
        // Custom rarity order:
        const order = [RARITY.COMMON, RARITY.RARE, RARITY.EPIC, RARITY.LEGENDARY];
        return order.indexOf(rarA) - order.indexOf(rarB);
      });
      for (const key of sortedOwned) {
        const item = allItems[key];
        const btn = document.createElement('button');
        btn.classList.add('choice');
        btn.dataset.choice = key;
        btn.style.borderColor = item.color;
        btn.innerHTML = `<span class="choice-icon" aria-hidden="true">${item.icon}</span>${item.name}`;
        btn.title = `${item.name} (${item.rarity})`;
        choicesDiv.appendChild(btn);
      }
      // Add click listeners
      choicesDiv.querySelectorAll('button.choice').forEach(btn => {
        btn.addEventListener('click', () => {
          playRound(btn.dataset.choice);
        });
      });
    }

    // Build shop UI grouped by rarity
    function buildShop() {
      shopDiv.innerHTML = '';

      // Group items by rarity
      const grouped = {};
      for (const [key, item] of Object.entries(allItems)) {
        if (ownedItems.has(key)) continue; // skip owned
        if (!grouped[item.rarity]) grouped[item.rarity] = [];
        grouped[item.rarity].push({ key, ...item });
      }

      const rarityOrder = [RARITY.COMMON, RARITY.RARE, RARITY.EPIC, RARITY.LEGENDARY];

      for (const rarity of rarityOrder) {
        if (!grouped[rarity] || grouped[rarity].length === 0) continue;

        const section = document.createElement('div');
        section.classList.add('rarity-section');
        section.textContent = rarity;
        shopDiv.appendChild(section);

        grouped[rarity].sort((a,b) => a.cost - b.cost || a.name.localeCompare(b.name));

        grouped[rarity].forEach(item => {
          const div = document.createElement('div');
          div.classList.add('item', `rarity-${rarity}`);

          // Disable if cost > coins
          const canBuy = coins >= item.cost;
          if (!canBuy) div.classList.add('disabled');

          div.tabIndex = canBuy ? 0 : -1;
          div.setAttribute('role', 'button');
          div.setAttribute('aria-pressed', 'false');
          div.setAttribute('aria-label', `${item.name}, costs ${item.cost} coins, rarity ${rarity}`);

          div.innerHTML = `
            <div class="name"><span class="icon" aria-hidden="true">${item.icon}</span>${item.name}</div>
            <div class="price">${item.cost}ðŸª™</div>
          `;

          if (canBuy) {
            div.addEventListener('click', () => buyItem(item.key));
            div.addEventListener('keydown', e => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                buyItem(item.key);
              }
            });
          }

          shopDiv.appendChild(div);
        });
      }
    }

    // Bot picks a random owned or unlocked item
    function botPick() {
      const keys = Object.keys(allItems);
      // Bot can pick any item (owned or not), weighted to commons more often:
      // Let's bias commons with weight 3, rares 2, epics 1, legendary 0.5
      const weights = {
        [RARITY.COMMON]: 3,
        [RARITY.RARE]: 2,
        [RARITY.EPIC]: 1,
        [RARITY.LEGENDARY]: 0.5,
      };

      // Build weighted array
      const weightedArr = [];
      for (const key of keys) {
        const rarity = allItems[key].rarity;
        const weight = weights[rarity] || 1;
        for (let i = 0; i < weight; i++) weightedArr.push(key);
      }

      const pick = weightedArr[Math.floor(Math.random() * weightedArr.length)];
      return pick;
    }

    // Determine winner, returns 'player', 'bot', or 'tie'
    function determineWinner(playerChoice, botChoice) {
      if (playerChoice === botChoice) return 'tie';
      const playerBeats = allItems[playerChoice].beats;
      if (playerBeats.includes(botChoice)) return 'player';
      const botBeats = allItems[botChoice].beats;
      if (botBeats.includes(playerChoice)) return 'bot';
      return 'tie'; // fallback safe
    }

    // Animate buttons for choices (simple scale + glow)
    async function animateChoices(playerChoice, botChoice) {
      const playerBtn = choicesDiv.querySelector(`button[data-choice="${playerChoice}"]`);
      // For bot we create a temp button visually
      const botBtn = document.createElement('button');
      botBtn.className = 'choice';
      const botItem = allItems[botChoice];
      botBtn.style.borderColor = botItem.color;
      botBtn.innerHTML = `<span class="choice-icon" aria-hidden="true">${botItem.icon}</span>${botItem.name}`;
      botBtn.style.position = 'absolute';
      botBtn.style.top = '12px';
      botBtn.style.right = '-110px';
      botBtn.style.zIndex = 1000;
      botBtn.style.pointerEvents = 'none';
      botBtn.style.width = '90px';
      botBtn.style.height = '90px';
      botBtn.style.opacity = '0.9';
      botBtn.style.transition = 'transform 0.5s ease, box-shadow 0.5s ease';
      document.getElementById('container').appendChild(botBtn);

      // Animate player
      playerBtn.style.transform = 'scale(1.3)';
      playerBtn.style.boxShadow = `0 0 20px 6px ${allItems[playerChoice].color}`;
      // Animate bot button in and out
      botBtn.style.transform = 'translateX(-130px) scale(1.3)';
      botBtn.style.boxShadow = `0 0 20px 6px ${botItem.color}`;

      await new Promise(r => setTimeout(r, 700));

      playerBtn.style.transform = 'scale(1)';
      playerBtn.style.boxShadow = 'none';
      botBtn.style.transform = 'translateX(0) scale(1)';
      botBtn.style.boxShadow = 'none';

      await new Promise(r => setTimeout(r, 400));

      botBtn.remove();
    }

    // Play one round of game with player's chosen item
    async function playRound(playerChoice) {
      if (!ownedItems.has(playerChoice)) return;

      disableChoices(true);
      resultsDiv.textContent = 'Bot is choosing...';

      const botChoice = botPick();

      await animateChoices(playerChoice, botChoice);

      const winner = determineWinner(playerChoice, botChoice);

      let resultText;
      if (winner === 'player') {
        playerScore++;
        coins += 10;
        resultText = `You win! ${allItems[playerChoice].name} beats ${allItems[botChoice].name}. +10ðŸª™`;
      } else if (winner === 'bot') {
        botScore++;
        resultText = `You lose! ${allItems[botChoice].name} beats ${allItems[playerChoice].name}.`;
      } else {
        resultText = `It's a tie! You both chose ${allItems[playerChoice].name}.`;
      }
      resultsDiv.textContent = resultText;
      updateCoins();
      updateScores();
      buildShop();
      disableChoices(false);
    }

    function disableChoices(disable) {
      choicesDiv.querySelectorAll('button.choice').forEach(btn => {
        btn.disabled = disable;
      });
    }

    // Buy an item from shop
    function buyItem(key) {
      if (ownedItems.has(key)) return; // already owned
      const item = allItems[key];
      if (coins >= item.cost) {
        coins -= item.cost;
        ownedItems.add(key);
        resultsDiv.textContent = `You bought ${item.name}! Now you can play with it.`;
        updateCoins();
        buildShop();
        buildChoices();
      } else {
        resultsDiv.textContent = `You don't have enough coins for ${item.name}.`;
      }
    }

    // Toggle views
    function showGame() {
      btnGame.classList.add('active');
      btnShop.classList.remove('active');
      gameView.style.display = 'flex';
      shopView.style.display = 'none';
      resultsDiv.focus();
    }
    function showShop() {
      btnShop.classList.add('active');
      btnGame.classList.remove('active');
      shopView.style.display = 'flex';
      gameView.style.display = 'none';
      shopView.focus();
    }

    btnGame.addEventListener('click', showGame);
    btnShop.addEventListener('click', showShop);

    // Initialization
    updateCoins();
    updateScores();
    buildChoices();
    buildShop();
    showGame();

  </script>
</body>
</html>
